# Regional spectrum {#sec-spectrum-reg}

```{r}
#| label: setup
#| echo: false
#| message: false
#| warning: false

source("_common.R")

# Load packages other than tidyverse and hdatools

library(tidycensus)
library(srvyr)

# Load data

pums_faar <- read_rds("data/pums/pums_faar.rds")

pums_faar_hh <- pums_faar |> filter(SPORDER == 1)

```

This report outlines the *housing spectrum* concept and its utility for understanding housing market dynamics. It includes assessments of households in the region by various demographic and socioeconomic characteristics, primarily by wages/income. Special analysis for the region's core workforce (i.e. persons both living and working within the region) can be found in @sec-spectrum-work.

::: {.callout-tip}
### How AMIs and the "region" are defined

The Area Median Income (AMI) categories in the regional housing spectrum are custom limits developed from the same methods used by the U.S. Department of Housing and Urban Development (HUD). Because HUD does not publish official limits for *just* the Fredercksburg region, new AMIs were calculated using the latest available microdata from the American Community Survey (ACS).

ACS microdata are available at the same geography served by the George Washington Regional Commission (GWRC), known officially as *Planning District 16*. The five localities in this area include:

* City of Fredericksburg
* Caroline County
* King George County
* Spotsylvania County
* Stafford County

Together, these jurisdictions are collectively referred to as "the region" throughout the report.

*See @sec-data-notes for a detailed explainer on HUD AMIs and the specific methods used to generate custom income limits for the region.*
:::

## Overview

With few exceptions, housing opportunities are primarily limited by how much money a household has available to buy or rent a home. To create a regional housing spectrum, we first need to group households according to their incomes. The categories used here, along with their respective plain-language descriptions, are shown below.

```{r}
#| label: tbl-ami-labels
#| tbl-cap: "Housing spectrum income group categories"
#| html-table-processing: none

ami_labels <- data.frame(
  level = rev(levels(pums_faar$ami_faar)),
  label = c(
    "High-income", "Above-average income", "Moderate-income", "Low-income",
    "Very low-income", "Extremely low-income", "No income"
  )
)

ami_labels |> 
  kbl(
    col.names = c("Income group", "Description"),
    align = "lr"
  ) |>
  column_spec(2, italic = T) |> 
  kable_styling(c("condensed", "striped"), full_width = F)

```

### Income

Based on 2018-2022 ACS 5-year estimates, there are approximately 385,000 persons living in 132,300 households across the region.[^gq] Over a third (36.1%) of these are high-income households. The next most common group are low-income households (18.4%). All other households with positive incomes are roughly divided even (at 10-13% each) among other income groups.

[^gq]: Persons living in *group quarters*, such as college dorms and nursing homes, are excluded from this analysis.

```{r}
#| label: fig-ami
#| fig.cap: "Households by AMI category"

pums_faar_hh |> 
  to_survey(type = "housing", design = "rep_weights") |>
  group_by(ami_faar) |> 
  summarise(
    n = survey_total(vartype = "cv")
  ) |> 
  ungroup() |> 
  mutate(
    pct = n/sum(n),
    color = case_when(
      ami_faar == "Zero or negative income" ~ "1",
      .default = "0"
    )
  ) |> 
  ggplot(aes(x = n, y = ami_faar, fill = color, color = color)) +
  geom_col() +
  geom_text(
    aes(label = label_comma()(n)),
    color = "white",
    hjust = 1,
    nudge_x = -950
  ) +
  geom_text(
    aes(label = label_percent(accuracy = 0.1)(pct)),
    hjust = 0,
    nudge_x = 500
  ) +
  scale_color_manual(
    values = c("0" = hda_pal[1], "1" = hda_pal[4])
  ) +
  scale_fill_manual(
    values = c("0" = hda_pal[1], "1" = hda_pal[4])
  ) +
  scale_y_discrete(labels = label_wrap(20)) +
  scale_x_continuous(
    limits = c(0, 52000),
    expand = c(0.01, 0.01),
    breaks = seq(0, 40000, 10000),
    labels = label_comma()
  ) +
  add_zero_line("x") +
  labs(
    title = "Households by AMI category",
    subtitle = "All households in GWRC region",
    caption = "**Source:** HDAdvisors calculations of 2018-2022 ACS 5-year PUMS."
  ) +
  theme_hda(flip_gridlines = T)

```

::: {.callout-note}
### No income households excluded

Fewer than 1,000 households (<1%) reported no income for the 12 months prior to their survey response. While the housing needs of this small group represent an outsized component of the region's housing challenges, the small sample of responses prevents reliable estimates from being calculated. As a result, these records are mostly excluded from the remainder of the report.
:::

### Tenure

...

```{r}
#| label: fig-ami-tenure
#| fig.cap: "Households by AMI and tenure"

fig_tenure_subtitle <- paste(
  "Percent of households who are",
  "<span style='color: #445ca9'><b>renters</b></span> or",
  "<span style='color: #8baeaa'><b>homeowners</b></span>"
)

pums_faar_hh |> 
  filter(hh_income > 0) |> 
  to_survey(type = "housing", design = "rep_weights") |>
  group_by(ami_faar, tenure) |> 
  summarise(
    n = survey_total(vartype = "cv")
  ) |> 
  mutate(
    pct = n/sum(n)
  ) |> 
  ungroup() |> 
  ggplot(aes(x = pct, y = ami_faar, fill = rev(tenure), group = tenure)) +
  geom_col() +
  geom_text(
    aes(label = label_percent()(pct)),
    position = position_stack(vjust = 0.5),
    color = "white"
  ) +
  scale_fill_hda() +
  scale_x_continuous(expand = c(0.01, 0)) +
  labs(
    title = "Households by AMI and tenure",
    subtitle = fig_tenure_subtitle,
    caption = "**Source:** HDAdvisors calculations of 2018-2022 ACS 5-year PUMS."
  ) +
  theme_hda(
    panel.grid.major.y = element_blank(),
    axis.text.x = element_blank()
  )

```

