# Regional spectrum {#sec-spectrum-reg}

```{r}
#| label: setup
#| echo: false
#| message: false
#| warning: false

source("_common.R")

# Load packages other than tidyverse and hdatools
library(tidycensus)
library(srvyr)
library(ggridges)

# Load PUMS data
pums_faar <- read_rds("data/pums/pums_faar.rds")

# Household records only
pums_faar_hh <- pums_faar |> filter(SPORDER == 1)

# AMI summary table
tbl_ami <- read_rds("data/spectrum_reg/tbl_ami.rds")

# Plot caption for PUMS source
pums_cap <- pums_cap

```

This report outlines the *housing spectrum* concept and its utility for understanding housing market dynamics. It includes assessments of households in the region by various demographic and socioeconomic characteristics, primarily by wages/income. Special analysis for the region's core workforce (i.e. persons both living and working within the region) can be found in @sec-spectrum-work.

::: {.callout-tip}
### How AMIs and the "region" are defined

The Area Median Income (AMI) categories in the regional housing spectrum are custom limits developed from the same methods used by the U.S. Department of Housing and Urban Development (HUD). Because HUD does not publish official limits for *just* the Fredercksburg region, new AMIs were calculated using the latest available microdata from the American Community Survey (ACS).

ACS microdata are available at the same geography served by the George Washington Regional Commission (GWRC), known officially as *Planning District 16*. The five localities in this area include:

* City of Fredericksburg
* Caroline County
* King George County
* Spotsylvania County
* Stafford County

Together, these jurisdictions are collectively referred to as "the region" throughout the report.

*See @sec-data-notes for a detailed explainer on HUD AMIs and the specific methods used to generate custom income limits for the region.*
:::

## Overview

With few exceptions, housing opportunities are primarily limited by how much money a household has available to buy or rent a home. To create a regional housing spectrum, we first need to group households according to their incomes. The categories used here, along with their respective plain-language descriptions, are shown below.

```{r}
#| label: tbl-ami-labels
#| tbl-cap: "Housing spectrum income group categories"

ami_labels <- data.frame(
  ami_faar = rev(levels(pums_faar$ami_faar)),
  label = c(
    "High-income", "Above-average income", "Moderate-income", "Low-income",
    "Very low-income", "Extremely low-income", "No income"
  )
)

ami_labels |> 
  kbl(
    col.names = c("Income group (AMI)", "Description"),
    align = "lr"
  ) |>
  column_spec(2, italic = T) |> 
  kable_styling(c("condensed", "striped"), full_width = F)

```

### Income

Based on 2018-2022 ACS 5-year estimates, there are approximately 385,000 persons living in 132,300 households across the region.[^gq] Over a third (36.1%) of these are high-income households. The next most common group are low-income households (18.4%). All other households with positive incomes are roughly divided even (at 10-13% each) among other income groups.

[^gq]: Persons living in *group quarters*, such as college dorms and nursing homes, are excluded from this analysis.

```{r}
#| label: fig-ami
#| fig.cap: "Households by AMI"

read_rds("data/spectrum_reg/fig_ami.rds") |> 
  ggplot(aes(x = n, y = ami_faar, fill = color, color = color)) +
  geom_col() +
  geom_text(
    aes(label = label_comma()(n)),
    color = "white",
    alpha = 0.8,
    hjust = 1,
    nudge_x = -950
  ) +
  geom_text(
    aes(label = label_percent(accuracy = 0.1)(pct)),
    hjust = 0,
    nudge_x = 500
  ) +
  scale_color_manual(
    values = c("0" = hda_pal[1], "1" = hda_pal[4])
  ) +
  scale_fill_manual(
    values = c("0" = hda_pal[1], "1" = hda_pal[4])
  ) +
  scale_y_discrete(labels = label_wrap(20)) +
  scale_x_continuous(
    limits = c(0, 52000),
    expand = c(0.01, 0.01),
    breaks = seq(0, 40000, 10000),
    labels = label_comma()
  ) +
  add_zero_line("x") +
  labs(
    title = "Households by AMI",
    subtitle = "All households in GWRC region",
    caption = pums_cap
  ) +
  theme_hda(flip_gridlines = T)

```

::: {.callout-note}
### Households with no income excluded

Fewer than 1,000 households (<1%) did not have a net positive income for the 12 months prior to their survey response. While the housing needs of this small group represent an outsized component of the region's housing challenges, the small sample of responses prevents reliable estimates from being calculated. As a result, these records are mostly excluded from the remainder of the report.
:::

We can provide a clearer picture of actual household incomes within these AMI groups by plotting their distributions, as shown in the figure below. The overlapping curves demonstrate that while incomes generally increase with higher AMI percentages, there's significant variation within each group due to the variety of household sizes represented.

```{r}
#| label: fig-ami-dist
#| fig.cap: "Distribution of household incomes by AMI"

ami_wm <- read_rds("data/spectrum_reg/ami_wm.rds")

read_rds("data/spectrum_reg/fig_ami_dist.rds") |> 
  ggplot(aes(x = hh_income, y = ami_faar, fill = ami_faar)) +
  geom_density_ridges2(
    aes(weight = WGTP, scale = 2.5),
    color = NA,
    alpha = 0.75,
    linewidth = 0.75
  ) +
  geom_text(
    data = ami_wm,
    aes(x = wm, y = ami_faar, label = paste0(label_dollar()(wm), "\n", "|")),
    color = "white",
    size = 3,
    lineheight = 0.8,
    nudge_y = 0.2
  ) +
  scale_fill_hda() +
  scale_y_discrete(expand = c(0, 0)) +
  scale_x_continuous(
    limits = c(0, 245000),
    expand = c(0.01, 0),
    labels = label_dollar(),
    position = "top"
  ) +
  labs(
    title = "Distribution of household incomes by AMI",
    subtitle = "Median household incomes in white",
    caption = pums_cap
  ) +
  theme_hda(
    flip_gridlines = TRUE,
    axis.text.x = element_text(size = 11, vjust = 0),
    axis.text.y = element_text(vjust = -2)
  )

```

This table adds the typical range for each AMI group to its descriptions.[^tr] For example, we now know to associate *low-income* households with incomes between roughly \$50,000 and \$90,000.

[^tr]: Here, *typical range* includes all values between the 10th and 90th percentiles. This removes outliers and reflects the middle 80% of households within each group.

```{r}
#| label: tbl-ami-range
#| tbl-cap: "Typical household income ranges by AMI"

ami_dist <- ami_labels |> 
  left_join(select(ami_wm, ami_faar, range)) |> 
  drop_na()

ami_dist |> 
  kbl(
    col.names = c("Income group (AMI)", "Description", "Typical range"),
    align = "llr"
  ) |>
  column_spec(2, italic = T) |> 
  kable_styling(c("condensed", "striped"), full_width = F)

```

### Tenure

For every 100 households in the region, 76 own their homes. Of these 76 homeowners, 58 are still making mortgage payments, while 18 have fully paid off their homes. The other 24 out of every 100 households are renters.

While homeownership becomes less common as we move down the income scale, homeowners still outnumber renters in every income group except for extremely low-income households. Of note are the slightly higher shares of homeowners below 50% AMI without mortgages---likely a reflection of seniors on fixed incomes who live in the same homes they purchased over 30 years ago.

```{r}
#| label: fig-ami-tenure
#| fig.cap: "Households by AMI and tenure"

fig_tenure_subtitle <- paste(
  "Percent who are",
  "<span style='color: #445ca9'><b>homeowners</b> (with mortgage)</span>,",
  "<span style='color: #8baeaa'><b>homeowners</b> (no mortgage)</span>, or",
  "<span style='color: #e9ab3f'><b>renters</b></span>"
)

read_rds("data/spectrum_reg/fig_ami_tenure.rds") |> 
  ggplot(aes(x = pct, y = ami_faar, fill = tenure_detail, group = fct_rev(tenure_detail))) +
  geom_col() +
  geom_text(
    aes(label = label_percent(accuracy = 1)(pct)),
    position = position_stack(vjust = 0.5),
    color = "white"
  ) +
  scale_fill_hda() +
  scale_x_continuous(expand = c(0.01, 0)) +
  labs(
    title = "Households by AMI and tenure",
    subtitle = fig_tenure_subtitle,
    caption = pums_cap
  ) +
  theme_hda(
    panel.grid.major.y = element_blank(),
    axis.text.x = element_blank()
  )

```

### Household characteristics

The most common type of household in the region are those headed by a married (or unmarried) couple. Single persons living alone are the next most common, and make up larger shares of households with incomes below 50% AMI. Single parents with at least one child are also more prevalent among lower-income households.

```{r}
#| label: fig-ami-hh-type
#| fig.cap: "Households by AMI and type"

read_rds("data/spectrum_reg/fig_ami_hh_type.rds") |> 
  ggplot(
    aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2.9, fill = hh_type)
  ) +
  facet_wrap(~ami_faar) +
  geom_rect() +
  geom_text(
    data = . %>% filter(pct > 0.05),
    aes(
      x = 3.5,
      y = pct_label,
      label = label_percent(accuracy = 1)(pct)
    ),
    color = "white"
  ) +
  coord_polar(theta = "y", clip = "off") +
  scale_x_continuous(
    limits = c(2, 4),
    expand = c(-0.1, 0)
  ) +
  scale_fill_hda() +
  labs(
    title = "Households by AMI and type",
    subtitle = "All households in GWRC region",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    axis.text = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.spacing.x = unit(3, "lines")
  )

```

Middle-aged households---where the average age of primary adults under one roof is between 35 and 64---are the most prevalent age group across every income level. Since these are the prime income-earning years for most adults, middle-aged households are a larger share of higher income households. Conversely, young households and senior/elderly households are more likely to have below-average incomes.

```{r}
#| label: fig-ami-hh-age
#| fig.cap: "Households by AMI and age"

read_rds("data/spectrum_reg/fig_ami_hh_age.rds") |>
  ggplot(
    aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2.9, fill = hh_age)
  ) +
  facet_wrap(~ami_faar) +
  geom_rect() +
  geom_text(
    data = . %>% filter(pct > 0.05),
    aes(
      x = 3.5,
      y = pct_label,
      label = label_percent(accuracy = 1)(pct)
    ),
    color = "white"
  ) +
  coord_polar(theta = "y", clip = "off") +
  scale_x_continuous(
    limits = c(2, 4),
    expand = c(-0.1, 0)
  ) +
  scale_fill_hda() +
  labs(
    title = "Households by AMI and age",
    subtitle = "Average age of householder and any spouse/partner/roommates",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    axis.text = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.spacing.x = unit(2.5, "lines")
  )

```

Only a third of all households have at least one school-aged child under 18. While this share is fairly consistent across all income levels, households earning between 50% AMI and 120% AMI are slightly more likely to have children than households with the lowest and highest incomes.

```{r}
#| label: fig-ami-hh-child
#| fig.cap: "Households by AMI and number of school-age children"

read_rds("data/spectrum_reg/fig_ami_hh_child.rds") |> 
  ggplot(
    aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2.9, fill = minors)
  ) +
  facet_wrap(~ami_faar) +
  geom_rect() +
  geom_text(
    data = . %>% filter(pct > 0.05),
    aes(
      x = 3.5,
      y = pct_label,
      label = label_percent(accuracy = 1)(pct)
    ),
    color = "white"
  ) +
  coord_polar(theta = "y", clip = "off") +
  scale_x_continuous(
    limits = c(2, 4),
    expand = c(-0.1, 0)
  ) +
  scale_fill_hda() +
  labs(
    title = "Households by AMI and number of school-age children",
    subtitle = "All households in GWRC region",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    axis.text = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.spacing.x = unit(3.5, "lines")
  )

```

### Employment

The majority of adults in the region who are between 25 to 54, and who do not have a disability, are currently employed or looking for work. While another small share are active duty members of the military, any of those adults not actively working or seeking jobs are outside of the labor force. With very little or no income of their own, non-working individuals are much more likely to be part of households below 50% AMI. 

::: {.callout-tip}
### Who could work, but isn't?
Among persons in extremely and very low-income households who are not in the labor force and do not have a disability, many are probably *stay-at-home moms*. These individuals are mostly women (83%) who live with at least one earner (80%), and live with at least one child (80%).
:::


```{r}
#| label: fig-ami-employ
#| fig.cap: "Employment status of prime working age non-disabled adults by AMI"

read_rds("data/spectrum_reg/fig_ami_employ.rds") |> 
  ggplot(
    aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2.9, fill = emp_status)
  ) +
  facet_wrap(~ami_faar) +
  geom_rect() +
  geom_text(
    data = . %>% filter(pct > 0.05),
    aes(
      x = 3.5,
      y = pct_label,
      label = label_percent(accuracy = 1)(pct)
    ),
    color = "white"
  ) +
  coord_polar(theta = "y", clip = "off") +
  scale_x_continuous(
    limits = c(2, 4),
    expand = c(-0.1, 0)
  ) +
  scale_fill_hda() +
  labs(
    title = "Employment status of prime working age non-disabled adults by AMI",
    subtitle = "All adults aged 25–54 without a disability",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    axis.text = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.spacing.x = unit(3.5, "lines")
  )

```

Only 18% of all households in the region do not include someone earning income.[^earn] The majority of those are senior or elderly households (76%) with lower incomes. Households with incomes between 30% AMI and 80% AMI are more likely than average to have just a single earner, while double-earner households are increasingly prevalent as incomes go up.

Higher-income groups also have a noticeable share of households with three or more earners. Many of these multiple-earner households (68%) are families with at least one younger, working adult child still living with parents who have not retired. 

[^earn]: A person is an *earner* if their total pay from wages and/or self-employment income over the last 12 months is at least \$5,000. 

```{r}
#| label: fig-ami-earn
#| fig.cap: "Number of earners per household by AMI"

read_rds("data/spectrum_reg/fig_ami_earn.rds") |> 
  ggplot(
    aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 2.9, fill = hh_earners)
  ) +
  facet_wrap(~ami_faar) +
  geom_rect(stat = "identity") +
  geom_text(
    data = . %>% filter(pct > 0.05),
    aes(
      x = 3.5,
      y = pct_label,
      label = label_percent(accuracy = 1)(pct)
    ),
    color = "white"
  ) +
  coord_polar(theta = "y", clip = "off") +
  scale_x_continuous(
    limits = c(2, 4),
    expand = c(-0.1, 0)
  ) +
  scale_fill_hda() +
  labs(
    title = "Number of earners per household by AMI",
    subtitle = "All households in GWRC region",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    axis.text = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.spacing.x = unit(3.5, "lines")
  )

```


## Below 30% AMI

...

```{r}
#| label: tbl-below-30
#| tbl-cap: "Summary of households below 30% AMI"

fn_tbl_ami <- function(level){
  
  tbl_ami |> 
  filter(ami_faar == level) |> 
  select(-1) |> 
  kbl(
    col.names = c(level, "Summary"),
    align = "lr"
  ) |> 
  kable_styling(c("condensed", "striped"), full_width = F)
  
}

fn_tbl_ami("Below 30% AMI")

```

...

Housing type

```{r}
#| label: fig-30-str
#| fig-cap: "Types of homes occupied by households below 30% AMI"

library(waffle)

read_rds("data/spectrum_reg/fig_30_str.rds") |> 
  ggplot(
    aes(fill = str_type, values = n/50)
  ) +
  facet_wrap(~tenure) +
  geom_waffle(
    color = "white",
    n_rows = 10,
    size = 1,
    flip = TRUE
  ) +
  coord_equal() +
  scale_y_continuous(
    breaks = c(4, 8, 12, 16),
    labels = label_comma(scale = 500)
  ) +
  scale_fill_hda(guide = guide_legend(reverse = T)) +
  labs(
    title = "Types of homes occupied by households below 30% AMI",
    subtitle = "1 square = 500 households",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "right",
    legend.justification = "top",
    panel.grid.major.y = element_blank(),
    axis.ticks.y = element_line(linewidth = 0.5),
    axis.text.x = element_blank()
  )

```


Sources of income

...

```{r}
#| label: fig-30-soi
#| fig-cap: "Total income amounts by source"

read_rds("data/spectrum_reg/fig_30_soi.rds") |> 
  ggplot(aes(x = pct, y = tenure, fill = inc)) +
  facet_wrap(~tenure, ncol = 1, scales = "free_y") +
  geom_col() +
  geom_text(
    aes(label = label_percent(accuracy = 1)(pct)),
    position = position_stack(vjust = 0.5),
    color = "white"
  ) +
  scale_x_continuous(expand = c(0,0)) +
  scale_fill_hda(-1, guide = guide_legend(reverse = T)) +
  labs(
    title = "Income sources for households below 30% AMI",
    subtitle = "Percent of total annual income by source",
    caption = pums_cap
  ) +
  theme_hda(
    legend.position = "top",
    legend.justification = "left",
    axis.text = element_blank(),
    strip.text = element_markdown(hjust = 0)
  )

```


Public assistance

Housing costs


Year moved


## 30-50% AMI

...

```{r}
#| label: tbl-30-50
#| tbl-cap: "Summary of households between 30-50% AMI"

fn_tbl_ami("30-50% AMI")

```


## 50-80% AMI

...

```{r}
#| label: tbl-50-80
#| tbl-cap: "Summary of households between 50-80% AMI"

fn_tbl_ami("50-80% AMI")

```


## 80-100% AMI

...

```{r}
#| label: tbl-80-100
#| tbl-cap: "Summary of households between 80-100% AMI"

fn_tbl_ami("80-100% AMI")

```


## 100-120% AMI

...

```{r}
#| label: tbl-100-120
#| tbl-cap: "Summary of households between 100-120% AMI"

fn_tbl_ami("100-120% AMI")

```

##  Above 120% AMI

...

```{r}
#| label: tbl-above-120
#| tbl-cap: "Summary of households above 120% AMI"

fn_tbl_ami("Above 120% AMI")

```



