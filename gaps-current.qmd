# Current gaps {#sec-gaps-current}

```{r}
#| label: setup
#| echo: false
#| message: false
#| warning: false

source("_common.R")

# Load packages other than tidyverse and hdatools
# 
library(scales)
library(ggtext)

```

. . .

```{r}

supply_demand <- read_rds("data/fxburg_supply_demand.rds")

ami_order <- factor(supply_demand$ami, levels = c("30% AMI or below", "31-50% AMI",
                                           "51-80% AMI", "81-100% AMI", "101-120% AMI",
                                           "121% AMI and greater"))


title_text <- "<span style = 'color:#8baeaa'><b>Supply</b></span> and <span style = 'color:#445ca9'><b>Demand</span> in the region"



ggplot(supply_demand,
       aes(x = reorder(ami_order, desc(ami_order)),
           y = estimate,
           fill = value)) +
  geom_col(position = "dodge") +
  facet_wrap(~tenure) +
  theme_hda(base_size = 10) +
  scale_fill_hda() +
  coord_flip() +
  labs(title = title_text)


```


```{r}
## Create a bar graph showing the distribution of households by tenure. Focus on showing the change in households by tenure in terms of percent change from 2019 to 2022.

# Load necessary libraries
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)

# Read and process the data
tenure_data <- read_rds("data/b25003_project.rds")

# Filter for the years 2019 to 2022 and select necessary columns
tenure_filtered <- tenure_data |> 
  filter(year %in% c(2019, 2020, 2021, 2022)) |> 
  select(year, tenure, estimate)

# Calculate year-to-year percent changes
tenure_percent_change <- tenure_filtered |> 
  pivot_wider(names_from = year, values_from = estimate) |> 
  mutate(
    change_2020 = ((`2020` - `2019`) / `2019`) * 100,
    change_2021 = ((`2021` - `2020`) / `2020`) * 100,
    change_2022 = ((`2022` - `2021`) / `2021`) * 100
  ) |> 
  select(tenure, change_2020, change_2021, change_2022) |> 
  pivot_longer(cols = starts_with("change"), names_to = "year", values_to = "percent_change") |> 
  mutate(year = case_when(
    year == "change_2020" ~ "2020",
    year == "change_2021" ~ "2021",
    year == "change_2022" ~ "2022"
  ))

# Plotting the data
ggplot(tenure_percent_change, aes(x = year, y = percent_change, fill = tenure)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_hda(base_size = 10) +  # Apply custom theme
  scale_fill_hda() +           # Apply custom scale
  labs(title = "Year-to-Year Percent Change in Households by Tenure (2019-2022)",
       x = "Year",
       y = "Percent Change (%)",
       fill = "Tenure") +
  geom_text(aes(label = round(percent_change, 1)), position = position_dodge(width = 0.9), vjust = -0.5)



```

